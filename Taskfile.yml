# https://taskfile.dev

version: '3'

tasks:
  default: task --list

  # Test tasks
  test:
    desc: Run all tests (Python packages and backend)
    cmds:
      - uv run pytest packages/pdf-reader/tests/ packages/xlsx-reader/tests/ apps/backend/tests/ -v

  test:short:
    desc: Run all tests with short traceback (useful for CI/CD)
    cmds:
      - uv run pytest packages/pdf-reader/tests/ packages/xlsx-reader/tests/ apps/backend/tests/ -v --tb=short

  test:watch:
    desc: Run Python tests in watch mode
    cmds:
      - uv run ptw -- packages/pdf-reader/tests/ packages/xlsx-reader/tests/ apps/backend/tests/ -v

  test:coverage:
    desc: Run tests with coverage report
    cmds:
      - uv run pytest packages/*/tests/ apps/backend/tests/ -v --cov=packages --cov=apps/backend --cov-report=html --cov-report=term

  # Individual package tests
  test:pdf:
    desc: Run PDF reader tests only
    cmds:
      - uv run pytest packages/pdf-reader/tests/ -v

  test:xlsx:
    desc: Run XLSX reader tests only
    cmds:
      - uv run pytest packages/xlsx-reader/tests/ -v

  # Backend tasks
  backend:dev:
    desc: Run backend dev server with auto-reload
    dir: apps/backend
    cmds:
      - uv run uvicorn backend.main:app --reload

  backend:test:
    desc: Run backend tests
    dir: apps/backend
    cmds:
      - uv run pytest -v

  # Frontend tasks (npm-based)
  frontend:install:
    desc: Install frontend dependencies
    dir: apps/frontend
    cmds:
      - npm install

  frontend:dev:
    desc: Run frontend dev server
    dir: apps/frontend
    cmds:
      - npm run dev

  frontend:build:
    desc: Build frontend for production
    dir: apps/frontend
    cmds:
      - npm run build

  frontend:test:
    desc: Run frontend tests
    dir: apps/frontend
    cmds:
      - npm run test
